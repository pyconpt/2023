



<!DOCTYPE html>
<html lang="en">
    
<!-- Mirrored from pretalx.evolutio.pt/pycon-pt-2023/talk/T9QPRH/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 11 Dec 2023 15:15:10 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
        <meta charset="utf-8">
        <title>Legacy apps, deadlines and project pragmatism - Delivering thousands of messages every night in primary healthcare ::  PyCon Portugal 2023 :: pretalx</title>
        <meta name="title" content="Legacy apps, deadlines and project pragmatism - Delivering thousands of messages every night in primary healthcare  - PyCon Portugal 2023 pretalx">
        <meta name="description" content="1. Introduction

In 2022, in the aftermath of the COVID pandemic peak, the problem of absences in patient healthcare appointments in primary care was revisited. There was also a need to catch up to the backlog of appointments that were cancelled. In order to maximize attendance, it was decided that patients should get reminders of their scheduled appointments, by text message, as SPMS, the Shared Services of the Ministry of Health had had a great experience with them in the vaccination scheduling effort.

However, the team working on Primary Care was still fully committed to the vaccination scheduling system and other tasks. The deadline was also short, basically &quot;As soon as possible&quot;. And I was the only one available to do it.

Who am I? Well, I&#x27;m a doctor, a family doctor to be more exact. A year and a half ago from starting this project, I was treating COVID patients in full protection suit. And as of that moment, I was a scientific consultant for Health apps. Doesn&#x27;t mean I didn&#x27;t spend a lot of time coding, as I had already some deployed internal apps, including a FastAPI service for your first vaccination schedule date.

2. Technical challenges

The task sounds simple when thinking about modern systems. Collect the upcoming appointments from the Electronic Health Record (EHR), and use a service to send the messages. However, the Portuguese primary care EHR is fragmented into multiple instances that serve a region. And the text message service used had to be a SOAP service. Given the timeframe and the fact that I still had to deliver on my other assignments, some compromises had to be made.

3. Shortcuts

The first and biggest shortcut to take has to be data gathering. I have to collect the data directly from the databases, as there was no time for anything else. This couples my app to the EHR data structure but it&#x27;s a compromise we are willing to make.

I also can’t get an actual database for my app in a short time, but I can settle for Redis. It&#x27;s fast to develop with Key Value databases, it won&#x27;t be a bottleneck and I can log message sending successes or failures (if there is a need to retry).

Configuration can be made from environment variables.

And we&#x27;ll host it all on a machine we already have, using a pipeline we&#x27;re familiar with... that turned out to be kubernetes K3s.

Our enterprise ecosystem is made up mostly from Java apps, with legacy systems using PL-SQL. So of course I had to go with python.

Why python? Because we can interact with oracle databases with a robust package (cx-oracle, now oracle-db), use a SOAP service easily with Zeep, schedule tasks with Celery, create an API to access information with FastAPI, and ensure someone else can take over really fast if we fall ill with COVID. And we can do it in a week if we have to.

4. Choose well the corners you cut

Don’t cut testing. At some point you start thinking that this thing you&#x27;re building will actually cost money. And if we send the wrong message, we can cost someone their appointment or worse, leak personal information. There are a lot of things that can go wrong. So we must make it bullet proof. That meant creating tests for the integrations that might fail, and all of the logic. And that allowed constant improvements of the not so good code to something that has been going non stop for a year.

Deployment. I can either deploy extremely fast today with a manual deployment and then suffer for eternity... or I can do it well, not perfectly but well enough. It&#x27;s especially good when you can reuse tried and tested pipelines, so there is a compromise to be made here. 
It can&#x27;t fail, it can&#x27;t wait for too long but it must also mean it&#x27;s easy to redeploy new versions as often as needed.

5. Things you can&#x27;t avoid

Everything in a large corporation takes longer than you wish. Want credentials to a service? Request, sign, wait. Access to databases? Wait for grants. Wait some more for firewall access. Clarification on the actual text of the message? Take a number. A pandemic is still happening and we need everything to both wait and happen simultaneously.
Everything feels both expedited and extremely slow in the corporate world. It&#x27;s demoralising sometimes because it contrasts with the extreme speed with which you&#x27;re developing with the snail pace of getting someone to stop what they&#x27;re doing and solve a ticket for you. It goes with the privilege of serving a whole country. It pays off, but it takes time.

6. What happens the day after?

Well, after you deliver that extremely urgent project, you can actually start to make it good. The pilot is only sending a hundred messages, but to send thousands, you must use async or threads. But you can&#x27;t just push everything at once, you&#x27;ll crash the message service.
And the code is still terrible so it&#x27;s time to refactor, because soon enough people will start to think of new things to put into the service. If everything is coupled, implementing new rules will start making big messes. If you&#x27;re afraid to make changes, it&#x27;s because you can&#x27;t trust your tests to protect you.

The key takeaway is, every time you make a new feature, leave the code better than you found it. Everything can&#x27;t be an emergency every time. This certainly wasn&#x27;t. At some point you have to say &quot;I can&#x27;t do that in that amount of time&quot;. Compromises can be reached, but they must always include tech debt repayment warranties.

7. How&#x27;s it going?

I&#x27;m fine, thank you. And the service is fine too!
The service is still only available to about half of the population, mostly in Lisbon. But as of the 21st of June 2023, we have sent more than five million messages. Some days we send more than 70 000. Not too bad for a service made by a doctor.">
        <meta name="application-name" content="pretalx">
        <meta name="generator" content="pretalx">
        <meta name="keywords" content="PyCon Portugal 2023, pycon-pt-2023, 2023, schedule, talks, cfp, call for papers, conference, submissions, organizer">
        
        <meta name="robots" content="index, follow">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#3aa57c">
        <meta name="HandheldFriendly" content="True"/>
        <meta property="thumbnail" content="logo-pycon2023-01_siVNJKr.png">
    <meta property="og:image" content="logo-pycon2023-01_siVNJKr.png">
        <meta property="og:title" content="Legacy apps, deadlines and project pragmatism - Delivering thousands of messages every night in primary healthcare PyCon Portugal 2023">
        <meta property="og:description" content="1. Introduction

In 2022, in the aftermath of the COVID pandemic peak, the problem of absences in patient healthcare appointments in primary care was revisited. There was also a need to catch up to the backlog of appointments that were cancelled. In order to maximize attendance, it was decided that patients should get reminders of their scheduled appointments, by text message, as SPMS, the Shared Services of the Ministry of Health had had a great experience with them in the vaccination scheduling effort.

However, the team working on Primary Care was still fully committed to the vaccination scheduling system and other tasks. The deadline was also short, basically &quot;As soon as possible&quot;. And I was the only one available to do it.

Who am I? Well, I&#x27;m a doctor, a family doctor to be more exact. A year and a half ago from starting this project, I was treating COVID patients in full protection suit. And as of that moment, I was a scientific consultant for Health apps. Doesn&#x27;t mean I didn&#x27;t spend a lot of time coding, as I had already some deployed internal apps, including a FastAPI service for your first vaccination schedule date.

2. Technical challenges

The task sounds simple when thinking about modern systems. Collect the upcoming appointments from the Electronic Health Record (EHR), and use a service to send the messages. However, the Portuguese primary care EHR is fragmented into multiple instances that serve a region. And the text message service used had to be a SOAP service. Given the timeframe and the fact that I still had to deliver on my other assignments, some compromises had to be made.

3. Shortcuts

The first and biggest shortcut to take has to be data gathering. I have to collect the data directly from the databases, as there was no time for anything else. This couples my app to the EHR data structure but it&#x27;s a compromise we are willing to make.

I also can’t get an actual database for my app in a short time, but I can settle for Redis. It&#x27;s fast to develop with Key Value databases, it won&#x27;t be a bottleneck and I can log message sending successes or failures (if there is a need to retry).

Configuration can be made from environment variables.

And we&#x27;ll host it all on a machine we already have, using a pipeline we&#x27;re familiar with... that turned out to be kubernetes K3s.

Our enterprise ecosystem is made up mostly from Java apps, with legacy systems using PL-SQL. So of course I had to go with python.

Why python? Because we can interact with oracle databases with a robust package (cx-oracle, now oracle-db), use a SOAP service easily with Zeep, schedule tasks with Celery, create an API to access information with FastAPI, and ensure someone else can take over really fast if we fall ill with COVID. And we can do it in a week if we have to.

4. Choose well the corners you cut

Don’t cut testing. At some point you start thinking that this thing you&#x27;re building will actually cost money. And if we send the wrong message, we can cost someone their appointment or worse, leak personal information. There are a lot of things that can go wrong. So we must make it bullet proof. That meant creating tests for the integrations that might fail, and all of the logic. And that allowed constant improvements of the not so good code to something that has been going non stop for a year.

Deployment. I can either deploy extremely fast today with a manual deployment and then suffer for eternity... or I can do it well, not perfectly but well enough. It&#x27;s especially good when you can reuse tried and tested pipelines, so there is a compromise to be made here. 
It can&#x27;t fail, it can&#x27;t wait for too long but it must also mean it&#x27;s easy to redeploy new versions as often as needed.

5. Things you can&#x27;t avoid

Everything in a large corporation takes longer than you wish. Want credentials to a service? Request, sign, wait. Access to databases? Wait for grants. Wait some more for firewall access. Clarification on the actual text of the message? Take a number. A pandemic is still happening and we need everything to both wait and happen simultaneously.
Everything feels both expedited and extremely slow in the corporate world. It&#x27;s demoralising sometimes because it contrasts with the extreme speed with which you&#x27;re developing with the snail pace of getting someone to stop what they&#x27;re doing and solve a ticket for you. It goes with the privilege of serving a whole country. It pays off, but it takes time.

6. What happens the day after?

Well, after you deliver that extremely urgent project, you can actually start to make it good. The pilot is only sending a hundred messages, but to send thousands, you must use async or threads. But you can&#x27;t just push everything at once, you&#x27;ll crash the message service.
And the code is still terrible so it&#x27;s time to refactor, because soon enough people will start to think of new things to put into the service. If everything is coupled, implementing new rules will start making big messes. If you&#x27;re afraid to make changes, it&#x27;s because you can&#x27;t trust your tests to protect you.

The key takeaway is, every time you make a new feature, leave the code better than you found it. Everything can&#x27;t be an emergency every time. This certainly wasn&#x27;t. At some point you have to say &quot;I can&#x27;t do that in that amount of time&quot;. Compromises can be reached, but they must always include tech debt repayment warranties.

7. How&#x27;s it going?

I&#x27;m fine, thank you. And the service is fine too!
The service is still only available to about half of the population, mostly in Lisbon. But as of the 21st of June 2023, we have sent more than five million messages. Some days we send more than 70 000. Not too bad for a service made by a doctor.">
        <meta property="og:url" content="index.html">
        <meta property="twitter:card" content="summary">

        
            <link rel="icon" type="image/png" sizes="32x32" href="../../../static/common/img/favicon-32x32.38c2aab28d3a.png">
            <link rel="icon" type="image/png" sizes="16x16" href="../../../static/common/img/favicon-16x16.02f8a56e1af3.png">
        

        <link rel="stylesheet" type="text/css" href="../../../static/common/scss/uncompressed.cabbf3759e3e.css" />
        
            <link rel="stylesheet" href="../../../static/CACHE/css/output.e2c9f5fa2f21.css" type="text/css">
        
        
        <script src="../../../static/CACHE/js/output.079684506270.js" defer></script>
        
    
    <link rel="alternate" type="application/json" title="PyCon Portugal 2023 API" href="https://pretalx.evolutio.pt/api/events/pycon-pt-2023/talks/T9QPRH" />

    
    

    </head>
    <body data-datetimeformat="YYYY-MM-DD HH:mm:ss" data-dateformat="YYYY-MM-DD" data-datetimelocale="pt-PT">
        <div id="top-bg" class="header bg-primary">
            
                <img src="https://pretalx.evolutio.pt/media/pycon-pt-2023/img/Screenshot_2023-04-11_at_12.04.53_FkhcUZ3.png" id="header-image">
            
        </div>
        
        <div class="container" id="main-container">
            <header>
                <h1>
                    <a href="../../schedule/index.html">
                        
                            <img src="https://pretalx.evolutio.pt/media/pycon-pt-2023/img/logo-pycon2023-01_siVNJKr.png" id="event-logo" alt="The event's logo">
                        
                    </a>
                </h1>
                <div class="d-flex" id="header-row">
                    
                    
                        <a href="../../login/index.html">login</a>
                    
                </div>
            </header>
            <div class="card" id="main-card">
                <main>
                    

                    
    
    
    <article>
        
        <h3 class="talk-title">
            <div class="heading-with-buttons">
                Legacy apps, deadlines and project pragmatism - Delivering thousands of messages every night in primary healthcare
                <div class="buttons" id="talk-buttons">
                    
                        <a class="btn btn-outline-primary" href="../pycon-pt-2023-T9QPRH.ics">
                            <i class="fa fa-calendar"></i> .ical
                        </a>
                    
                    
                        <a href="feedback/index.html"
                           class="btn btn-success">
                            <i class="fa fa-comments"></i> 
                        </a>
                    
                    
                </div>
            </div>
            <small>
                
                    09-07, 14:05–14:40 (Europe/Lisbon), Auditorium 
                
                
                
            </small>
        </h3>
        <div class="talk row">
            <div class="talk-content">
                
                
                
                <section class="abstract">
                    <p>In my talk I will go over the story of how I set up the service that sends text message reminders to patients of the Portuguese primary care health system. I will explain the constraints of working with a distributed silo legacy application and other proprietary projects in a large company, and the impact of that and short deadlines on application design. Python shines through the project for its vast amazing libraries, ease of design and speed of iteration.</p>
                </section>
                
                    <hr />
                
                <section class="description">
                    <ol>
<li>Introduction</li>
</ol>
<p>In 2022, in the aftermath of the COVID pandemic peak, the problem of absences in patient healthcare appointments in primary care was revisited. There was also a need to catch up to the backlog of appointments that were cancelled. In order to maximize attendance, it was decided that patients should get reminders of their scheduled appointments, by text message, as SPMS, the Shared Services of the Ministry of Health had had a great experience with them in the vaccination scheduling effort.</p>
<p>However, the team working on Primary Care was still fully committed to the vaccination scheduling system and other tasks. The deadline was also short, basically "As soon as possible". And I was the only one available to do it.</p>
<p>Who am I? Well, I'm a doctor, a family doctor to be more exact. A year and a half ago from starting this project, I was treating COVID patients in full protection suit. And as of that moment, I was a scientific consultant for Health apps. Doesn't mean I didn't spend a lot of time coding, as I had already some deployed internal apps, including a FastAPI service for your first vaccination schedule date.</p>
<ol>
<li>Technical challenges</li>
</ol>
<p>The task sounds simple when thinking about modern systems. Collect the upcoming appointments from the Electronic Health Record (EHR), and use a service to send the messages. However, the Portuguese primary care EHR is fragmented into multiple instances that serve a region. And the text message service used had to be a SOAP service. Given the timeframe and the fact that I still had to deliver on my other assignments, some compromises had to be made.</p>
<ol>
<li>Shortcuts</li>
</ol>
<p>The first and biggest shortcut to take has to be data gathering. I have to collect the data directly from the databases, as there was no time for anything else. This couples my app to the EHR data structure but it's a compromise we are willing to make.</p>
<p>I also can’t get an actual database for my app in a short time, but I can settle for Redis. It's fast to develop with Key Value databases, it won't be a bottleneck and I can log message sending successes or failures (if there is a need to retry).</p>
<p>Configuration can be made from environment variables.</p>
<p>And we'll host it all on a machine we already have, using a pipeline we're familiar with... that turned out to be kubernetes K3s.</p>
<p>Our enterprise ecosystem is made up mostly from Java apps, with legacy systems using PL-SQL. So of course I had to go with python.</p>
<p>Why python? Because we can interact with oracle databases with a robust package (cx-oracle, now oracle-db), use a SOAP service easily with Zeep, schedule tasks with Celery, create an API to access information with FastAPI, and ensure someone else can take over really fast if we fall ill with COVID. And we can do it in a week if we have to.</p>
<ol>
<li>Choose well the corners you cut</li>
</ol>
<p>Don’t cut testing. At some point you start thinking that this thing you're building will actually cost money. And if we send the wrong message, we can cost someone their appointment or worse, leak personal information. There are a lot of things that can go wrong. So we must make it bullet proof. That meant creating tests for the integrations that might fail, and all of the logic. And that allowed constant improvements of the not so good code to something that has been going non stop for a year.</p>
<p>Deployment. I can either deploy extremely fast today with a manual deployment and then suffer for eternity... or I can do it well, not perfectly but well enough. It's especially good when you can reuse tried and tested pipelines, so there is a compromise to be made here. <br>
It can't fail, it can't wait for too long but it must also mean it's easy to redeploy new versions as often as needed.</p>
<ol>
<li>Things you can't avoid</li>
</ol>
<p>Everything in a large corporation takes longer than you wish. Want credentials to a service? Request, sign, wait. Access to databases? Wait for grants. Wait some more for firewall access. Clarification on the actual text of the message? Take a number. A pandemic is still happening and we need everything to both wait and happen simultaneously.<br>
Everything feels both expedited and extremely slow in the corporate world. It's demoralising sometimes because it contrasts with the extreme speed with which you're developing with the snail pace of getting someone to stop what they're doing and solve a ticket for you. It goes with the privilege of serving a whole country. It pays off, but it takes time.</p>
<ol>
<li>What happens the day after?</li>
</ol>
<p>Well, after you deliver that extremely urgent project, you can actually start to make it good. The pilot is only sending a hundred messages, but to send thousands, you must use async or threads. But you can't just push everything at once, you'll crash the message service.<br>
And the code is still terrible so it's time to refactor, because soon enough people will start to think of new things to put into the service. If everything is coupled, implementing new rules will start making big messes. If you're afraid to make changes, it's because you can't trust your tests to protect you.</p>
<p>The key takeaway is, every time you make a new feature, leave the code better than you found it. Everything can't be an emergency every time. This certainly wasn't. At some point you have to say "I can't do that in that amount of time". Compromises can be reached, but they must always include tech debt repayment warranties.</p>
<ol>
<li>How's it going?</li>
</ol>
<p>I'm fine, thank you. And the service is fine too!<br>
The service is still only available to about half of the population, mostly in Lisbon. But as of the 21st of June 2023, we have sent more than five million messages. Some days we send more than 70 000. Not too bad for a service made by a doctor.</p>
                </section>
                
            </section>
            
            <section>
                
            </section>
        </div>
    </div>
    
        
            <div class="pretalx-session">
                <div class="pretalx-session-time-box avatar">
                    <a href="../../speaker/YPYG8X/index.html">
                        <div class="avatar-wrapper">
                            
                                <img src="https://pretalx.evolutio.pt/media/avatars/joao_epp0d3c.jpg">
                            
                        </div>
                    </a>
                </div>
                <div class="pretalx-session-info">
                    <div class="title">
                        <a href="../../speaker/YPYG8X/index.html">Joao Ferreira</a>
                    </div>
                    <div class="abstract"><p>I'm a family doctor by trade, however I've been coding for much longer than I've been working, and most of that time, it's been in Python. Today, I help make Healthcare better in the Shared Services of the Ministry of Health.</p></div>
                    
                </div>
            </div>
        
    
    </article>


                </main>
            </div>
            <footer>
                
                


    powered by <a href="https://pretalx.com/" target="_blank" rel="noopener">pretalx</a>


                
                    &middot;
                    <a href="mailto:content@pycon.pt">Contact us</a>
                
                
                
            </footer>
        </div>
    </body>

<!-- Mirrored from pretalx.evolutio.pt/pycon-pt-2023/talk/T9QPRH/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 11 Dec 2023 15:15:12 GMT -->
</html>
